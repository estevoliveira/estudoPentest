import sys,time,random
from scapy.all import *

#numero total de portas existentes 65535
portas=[]

conf.verb=0
pIP = IP(dst=sys.argv[1])
range_portas = sys.argv[2].split('-')

for i in range(int(range_portas[0]),int(range_portas[1])):
    portas.append(i)

with open(sys.argv[3],'a',encoding = 'utf-8') as f: 
    while(len(portas) != 0):
        escolha=random.choice(portas) 
        #Cria o pacote com a porta selecionada
        pTCP = TCP(dport=escolha,flags="S")
        pacote = pIP/pTCP
        #envia o pacote
        resp=sr1(pacote)
        flag = resp[TCP].flags
        if(flag == "SA"):
            print(f'Porta {escolha} ABERTA')
            f.write(f'Porta {escolha} ABERTA\n')
        else:
            f.write(f'Porta {escolha} FECHADA\n')

        #remove a porta da lista de portas, pois já foi verificada se esta up
        portas.remove(escolha)
        #espera alguns segundas para realizar o próximo request
        #Sleep em segundos
        time.sleep(5)